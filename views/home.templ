package views

import (
	"fmt"

	"github.com/alexander-bruun/magi/models"
)

templ Home() {
	@PageTitle("Magi")
	@Breadcrumb([]BreadcrumbItem{
		{ Label: "Home", Href: "/" },
	})

	<div class="mt-4">
		<div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
			<div class="lg:col-span-3">
				<h2 class="uk-heading-line uk-h2 uk-card-title uk-text-center"><span>Recently added</span></h2>
				{{ recentlyAdded, _, _ := models.SearchMangas("", 1, 20, "created_at", "desc", "", "") }}
				if len(recentlyAdded) == 0 {
					@EmptyState("No mangas have been indexed yet.")
				} else {
					@Showcase(recentlyAdded)
				}

				<h2 class="uk-heading-line uk-h2 uk-card-title uk-text-center"><span>Recently updated</span></h2>
				{{ recentlyUpdated, _, _ := models.SearchMangas("", 1, 20, "updated_at", "desc", "", "") }}
				if len(recentlyUpdated) == 0 {
					@EmptyState("No mangas have been indexed yet.")
				} else {
					@Showcase(recentlyUpdated)
				}
			</div>

			<div class="lg:col-span-1">
				<h2 class="uk-heading-line uk-h2 uk-card-title uk-text-center"><span>Top 10 Popular</span></h2>
				<div class="uk-card uk-card-default uk-card-body mt-6">
					{{ topMangas, _ := models.GetTopMangas(10) }}
					if len(topMangas) == 0 {
						@EmptyState("No mangas have been indexed yet.")
					} else {
						<ul class="top-manga-list">
							for i, m := range topMangas {
								{{ _, up, down, _ := models.GetMangaVotes(m.Slug) }}
								<li class="flex items-center gap-3 py-2">
									<div class="w-10 h-14 overflow-hidden rounded-sm">
										@MangaCover(m.CoverArtURL, m.Name, 80, 112, true)
									</div>
									<div class="flex-1">
										<a href={ fmt.Sprintf("/mangas/%s", m.Slug) } hx-get={ fmt.Sprintf("/mangas/%s", m.Slug) } hx-target="#content" hx-push-url="true" class="font-medium">{ m.Name }</a>
										<div class="text-xs uk-text-muted">{ m.Author }</div>
									</div>
									<div class="flex flex-col items-center">
										<div class="rank text-sm font-semibold">{ fmt.Sprint(i+1) }</div>
										<div class="text-xs uk-text-muted flex gap-2 mt-1 items-center">
											<span class="flex items-center gap-1"><uk-icon icon="ThumbsUp" stroke-width="2"></uk-icon> { fmt.Sprint(up) }</span>
											<span class="flex items-center gap-1"><uk-icon icon="ThumbsDown" stroke-width="2"></uk-icon> { fmt.Sprint(down) }</span>
										</div>
									</div>
								</li>
							}
						</ul>
					}
				</div>

			</div>
		</div>

		<h2 class="uk-heading-line uk-h2 uk-card-title uk-text-center mt-6"><span>Statistics</span></h2>
		<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
			{{ totalMangas, _ := models.GetTotalMangas() }}
			@StatCard("Total mangas", totalMangas)
			{{ totalChapters, _ := models.GetTotalChapters() }}
			@StatCard("Total chapters", totalChapters)
			{{ totalChaptersRead, _ := models.GetTotalChaptersRead() }}
			@StatCard("Chapters read", totalChaptersRead)
		</div>
	</div>
}
